package com.cinabro.gazuafolio.accounts;

import com.google.gson.JsonParser;
import com.webcerebrium.binance.api.BinanceApi;
import com.webcerebrium.binance.api.BinanceApiException;
import org.junit.Before;
import org.junit.Test;
import org.junit.runner.RunWith;
import org.mockito.InjectMocks;
import org.mockito.Mock;
import org.mockito.runners.MockitoJUnitRunner;

import java.util.List;
import java.util.Optional;

import static org.hamcrest.CoreMatchers.is;
import static org.junit.Assert.assertThat;
import static org.mockito.BDDMockito.given;

@RunWith(MockitoJUnitRunner.class)
public class BinanceExchangeServiceTest {

    @Mock
    private BinanceApi binanceApi = new BinanceApi();

    @InjectMocks
    private BinanceExchangeService targets;

    @Before
    public void setupBinanceApiResponse() throws BinanceApiException {
        JsonParser jsonParser = new JsonParser();

        String balancesJson = "[{\"asset\":\"BTC\",\"free\":\"0.00002700\",\"locked\":\"0.00000000\"},{\"asset\":\"LTC\",\"free\":\"0.00000000\",\"locked\":\"0.00000000\"},{\"asset\":\"ETH\",\"free\":\"0.00073411\",\"locked\":\"0.00000000\"},{\"asset\":\"BNC\",\"free\":\"0.00000000\",\"locked\":\"0.00000000\"},{\"asset\":\"ICO\",\"free\":\"0.00000000\",\"locked\":\"0.00000000\"},{\"asset\":\"NEO\",\"free\":\"0.00000000\",\"locked\":\"0.00000000\"},{\"asset\":\"BNB\",\"free\":\"0.00000000\",\"locked\":\"0.00000000\"},{\"asset\":\"123\",\"free\":\"0.00000000\",\"locked\":\"0.00000000\"},{\"asset\":\"456\",\"free\":\"0.00000000\",\"locked\":\"0.00000000\"},{\"asset\":\"QTUM\",\"free\":\"0.00000000\",\"locked\":\"0.00000000\"},{\"asset\":\"EOS\",\"free\":\"0.00000000\",\"locked\":\"0.00000000\"},{\"asset\":\"SNT\",\"free\":\"0.00000000\",\"locked\":\"0.00000000\"},{\"asset\":\"BNT\",\"free\":\"0.00000000\",\"locked\":\"0.00000000\"},{\"asset\":\"GAS\",\"free\":\"0.00000000\",\"locked\":\"0.00000000\"},{\"asset\":\"BCC\",\"free\":\"0.00000000\",\"locked\":\"0.00000000\"},{\"asset\":\"BTM\",\"free\":\"0.00000000\",\"locked\":\"0.00000000\"},{\"asset\":\"USDT\",\"free\":\"0.00000000\",\"locked\":\"0.00000000\"},{\"asset\":\"HCC\",\"free\":\"0.00000000\",\"locked\":\"0.00000000\"},{\"asset\":\"HSR\",\"free\":\"0.00000000\",\"locked\":\"0.00000000\"},{\"asset\":\"OAX\",\"free\":\"0.00000000\",\"locked\":\"0.00000000\"},{\"asset\":\"DNT\",\"free\":\"0.00000000\",\"locked\":\"0.00000000\"},{\"asset\":\"MCO\",\"free\":\"0.00000000\",\"locked\":\"0.00000000\"},{\"asset\":\"ICN\",\"free\":\"0.00000000\",\"locked\":\"0.00000000\"},{\"asset\":\"ELC\",\"free\":\"0.00000000\",\"locked\":\"0.00000000\"},{\"asset\":\"PAY\",\"free\":\"0.00000000\",\"locked\":\"0.00000000\"},{\"asset\":\"ZRX\",\"free\":\"0.00000000\",\"locked\":\"0.00000000\"},{\"asset\":\"OMG\",\"free\":\"0.00000000\",\"locked\":\"0.00000000\"},{\"asset\":\"WTC\",\"free\":\"0.00000000\",\"locked\":\"0.00000000\"},{\"asset\":\"LRX\",\"free\":\"0.00000000\",\"locked\":\"0.00000000\"},{\"asset\":\"YOYO\",\"free\":\"0.00000000\",\"locked\":\"0.00000000\"},{\"asset\":\"LRC\",\"free\":\"0.00000000\",\"locked\":\"0.00000000\"},{\"asset\":\"LLT\",\"free\":\"0.00000000\",\"locked\":\"0.00000000\"},{\"asset\":\"TRX\",\"free\":\"0.00000000\",\"locked\":\"0.00000000\"},{\"asset\":\"FID\",\"free\":\"0.00000000\",\"locked\":\"0.00000000\"},{\"asset\":\"SNGLS\",\"free\":\"0.00000000\",\"locked\":\"0.00000000\"},{\"asset\":\"STRAT\",\"free\":\"0.00000000\",\"locked\":\"0.00000000\"},{\"asset\":\"BQX\",\"free\":\"0.00000000\",\"locked\":\"0.00000000\"},{\"asset\":\"FUN\",\"free\":\"11385.60300000\",\"locked\":\"0.00000000\"},{\"asset\":\"KNC\",\"free\":\"0.00000000\",\"locked\":\"0.00000000\"},{\"asset\":\"CDT\",\"free\":\"0.00000000\",\"locked\":\"0.00000000\"},{\"asset\":\"XVG\",\"free\":\"0.00000000\",\"locked\":\"0.00000000\"},{\"asset\":\"IOTA\",\"free\":\"0.00000000\",\"locked\":\"0.00000000\"},{\"asset\":\"SNM\",\"free\":\"0.00000000\",\"locked\":\"0.00000000\"},{\"asset\":\"LINK\",\"free\":\"0.00000000\",\"locked\":\"0.00000000\"},{\"asset\":\"CVC\",\"free\":\"0.00000000\",\"locked\":\"0.00000000\"},{\"asset\":\"TNT\",\"free\":\"0.00000000\",\"locked\":\"0.00000000\"},{\"asset\":\"REP\",\"free\":\"0.00000000\",\"locked\":\"0.00000000\"},{\"asset\":\"CTR\",\"free\":\"307.69200000\",\"locked\":\"0.00000000\"},{\"asset\":\"MDA\",\"free\":\"0.00000000\",\"locked\":\"0.00000000\"},{\"asset\":\"MTL\",\"free\":\"0.00000000\",\"locked\":\"0.00000000\"},{\"asset\":\"SALT\",\"free\":\"0.00000000\",\"locked\":\"0.00000000\"},{\"asset\":\"NULS\",\"free\":\"0.00000000\",\"locked\":\"0.00000000\"},{\"asset\":\"SUB\",\"free\":\"0.00000000\",\"locked\":\"0.00000000\"},{\"asset\":\"STX\",\"free\":\"0.00000000\",\"locked\":\"0.00000000\"},{\"asset\":\"MTH\",\"free\":\"0.00000000\",\"locked\":\"0.00000000\"},{\"asset\":\"CAT\",\"free\":\"0.00000000\",\"locked\":\"0.00000000\"},{\"asset\":\"ADX\",\"free\":\"0.00000000\",\"locked\":\"0.00000000\"},{\"asset\":\"PIX\",\"free\":\"0.00000000\",\"locked\":\"0.00000000\"},{\"asset\":\"ETC\",\"free\":\"0.00000000\",\"locked\":\"0.00000000\"},{\"asset\":\"ENG\",\"free\":\"0.00000000\",\"locked\":\"0.00000000\"},{\"asset\":\"ZEC\",\"free\":\"0.00000000\",\"locked\":\"0.00000000\"},{\"asset\":\"AST\",\"free\":\"0.00000000\",\"locked\":\"0.00000000\"},{\"asset\":\"1ST\",\"free\":\"0.00000000\",\"locked\":\"0.00000000\"},{\"asset\":\"GNT\",\"free\":\"0.00000000\",\"locked\":\"0.00000000\"},{\"asset\":\"DGD\",\"free\":\"0.00000000\",\"locked\":\"0.00000000\"},{\"asset\":\"BAT\",\"free\":\"0.00000000\",\"locked\":\"0.00000000\"},{\"asset\":\"DASH\",\"free\":\"0.00000000\",\"locked\":\"0.00000000\"},{\"asset\":\"POWR\",\"free\":\"0.00000000\",\"locked\":\"0.00000000\"},{\"asset\":\"BTG\",\"free\":\"0.00000000\",\"locked\":\"0.00000000\"},{\"asset\":\"REQ\",\"free\":\"3375.62100000\",\"locked\":\"0.00000000\"},{\"asset\":\"XMR\",\"free\":\"0.00000000\",\"locked\":\"0.00000000\"},{\"asset\":\"EVX\",\"free\":\"0.00000000\",\"locked\":\"0.00000000\"},{\"asset\":\"VIB\",\"free\":\"0.00000000\",\"locked\":\"0.00000000\"},{\"asset\":\"ENJ\",\"free\":\"0.00000000\",\"locked\":\"0.00000000\"},{\"asset\":\"VEN\",\"free\":\"0.00000000\",\"locked\":\"0.00000000\"},{\"asset\":\"CAG\",\"free\":\"0.00000000\",\"locked\":\"0.00000000\"},{\"asset\":\"EDG\",\"free\":\"0.00000000\",\"locked\":\"0.00000000\"},{\"asset\":\"ARK\",\"free\":\"0.00000000\",\"locked\":\"0.00000000\"},{\"asset\":\"XRP\",\"free\":\"0.00000000\",\"locked\":\"0.00000000\"},{\"asset\":\"MOD\",\"free\":\"0.00000000\",\"locked\":\"0.00000000\"},{\"asset\":\"AVT\",\"free\":\"0.00000000\",\"locked\":\"0.00000000\"},{\"asset\":\"STORJ\",\"free\":\"0.00000000\",\"locked\":\"0.00000000\"},{\"asset\":\"KMD\",\"free\":\"0.00000000\",\"locked\":\"0.00000000\"},{\"asset\":\"RCN\",\"free\":\"0.00000000\",\"locked\":\"0.00000000\"},{\"asset\":\"EDO\",\"free\":\"0.00000000\",\"locked\":\"0.00000000\"},{\"asset\":\"QASH\",\"free\":\"0.00000000\",\"locked\":\"0.00000000\"},{\"asset\":\"SAN\",\"free\":\"0.00000000\",\"locked\":\"0.00000000\"},{\"asset\":\"DATA\",\"free\":\"0.00000000\",\"locked\":\"0.00000000\"},{\"asset\":\"DLT\",\"free\":\"0.00000000\",\"locked\":\"0.00000000\"},{\"asset\":\"GUP\",\"free\":\"0.00000000\",\"locked\":\"0.00000000\"},{\"asset\":\"MCAP\",\"free\":\"0.00000000\",\"locked\":\"0.00000000\"},{\"asset\":\"MANA\",\"free\":\"0.00000000\",\"locked\":\"0.00000000\"},{\"asset\":\"PPT\",\"free\":\"0.00000000\",\"locked\":\"0.00000000\"},{\"asset\":\"OTN\",\"free\":\"0.00000000\",\"locked\":\"0.00000000\"},{\"asset\":\"CFD\",\"free\":\"0.00000000\",\"locked\":\"0.00000000\"},{\"asset\":\"RDN\",\"free\":\"0.00000000\",\"locked\":\"0.00000000\"},{\"asset\":\"GXS\",\"free\":\"0.00000000\",\"locked\":\"0.00000000\"},{\"asset\":\"AMB\",\"free\":\"0.00000000\",\"locked\":\"0.00000000\"},{\"asset\":\"ARN\",\"free\":\"0.00000000\",\"locked\":\"0.00000000\"},{\"asset\":\"BCPT\",\"free\":\"0.00000000\",\"locked\":\"0.00000000\"},{\"asset\":\"CND\",\"free\":\"0.00000000\",\"locked\":\"0.00000000\"},{\"asset\":\"GVT\",\"free\":\"0.00000000\",\"locked\":\"0.00000000\"},{\"asset\":\"POE\",\"free\":\"0.00000000\",\"locked\":\"0.00000000\"},{\"asset\":\"ALIS\",\"free\":\"0.00000000\",\"locked\":\"0.00000000\"},{\"asset\":\"BTS\",\"free\":\"0.00000000\",\"locked\":\"0.00000000\"},{\"asset\":\"FUEL\",\"free\":\"0.00000000\",\"locked\":\"0.00000000\"},{\"asset\":\"XZC\",\"free\":\"0.00000000\",\"locked\":\"0.00000000\"},{\"asset\":\"QSP\",\"free\":\"0.00000000\",\"locked\":\"0.00000000\"},{\"asset\":\"LSK\",\"free\":\"0.00000000\",\"locked\":\"0.00000000\"},{\"asset\":\"BCD\",\"free\":\"0.00000000\",\"locked\":\"0.00000000\"},{\"asset\":\"TNB\",\"free\":\"0.00000000\",\"locked\":\"0.00000000\"},{\"asset\":\"GRX\",\"free\":\"0.00000000\",\"locked\":\"0.00000000\"},{\"asset\":\"STAR\",\"free\":\"0.00000000\",\"locked\":\"0.00000000\"},{\"asset\":\"ADA\",\"free\":\"0.00000000\",\"locked\":\"0.00000000\"},{\"asset\":\"LEND\",\"free\":\"0.00000000\",\"locked\":\"0.00000000\"},{\"asset\":\"IFT\",\"free\":\"0.00000000\",\"locked\":\"0.00000000\"},{\"asset\":\"KICK\",\"free\":\"0.00000000\",\"locked\":\"0.00000000\"},{\"asset\":\"UKG\",\"free\":\"0.00000000\",\"locked\":\"0.00000000\"},{\"asset\":\"VOISE\",\"free\":\"0.00000000\",\"locked\":\"0.00000000\"},{\"asset\":\"XLM\",\"free\":\"0.00000000\",\"locked\":\"0.00000000\"},{\"asset\":\"CMT\",\"free\":\"0.00000000\",\"locked\":\"0.00000000\"},{\"asset\":\"WAVES\",\"free\":\"0.00000000\",\"locked\":\"0.00000000\"},{\"asset\":\"WABI\",\"free\":\"0.00000000\",\"locked\":\"0.00000000\"},{\"asset\":\"SBTC\",\"free\":\"0.00000000\",\"locked\":\"0.00000000\"},{\"asset\":\"BCX\",\"free\":\"0.00000000\",\"locked\":\"0.00000000\"},{\"asset\":\"GTO\",\"free\":\"0.00000000\",\"locked\":\"0.00000000\"},{\"asset\":\"ETF\",\"free\":\"0.00000000\",\"locked\":\"0.00000000\"},{\"asset\":\"ICX\",\"free\":\"0.00000000\",\"locked\":\"0.00000000\"},{\"asset\":\"OST\",\"free\":\"0.00000000\",\"locked\":\"0.00000000\"},{\"asset\":\"ELF\",\"free\":\"0.00000000\",\"locked\":\"0.00000000\"},{\"asset\":\"AION\",\"free\":\"0.00000000\",\"locked\":\"0.00000000\"},{\"asset\":\"WINGS\",\"free\":\"0.00000000\",\"locked\":\"0.00000000\"},{\"asset\":\"BRD\",\"free\":\"0.00000000\",\"locked\":\"0.00000000\"},{\"asset\":\"NEBL\",\"free\":\"0.00000000\",\"locked\":\"0.00000000\"},{\"asset\":\"NAV\",\"free\":\"0.00000000\",\"locked\":\"0.00000000\"},{\"asset\":\"VIBE\",\"free\":\"0.00000000\",\"locked\":\"0.00000000\"},{\"asset\":\"LUN\",\"free\":\"0.00000000\",\"locked\":\"0.00000000\"},{\"asset\":\"TRIG\",\"free\":\"0.00000000\",\"locked\":\"0.00000000\"},{\"asset\":\"APPC\",\"free\":\"0.00000000\",\"locked\":\"0.00000000\"},{\"asset\":\"CHAT\",\"free\":\"0.00000000\",\"locked\":\"0.00000000\"}]";
        String allPricesJson = "[{\"symbol\":\"ETHBTC\",\"price\":\"0.06379600\"},{\"symbol\":\"LTCBTC\",\"price\":\"0.01678700\"},{\"symbol\":\"BNBBTC\",\"price\":\"0.00119250\"},{\"symbol\":\"NEOBTC\",\"price\":\"0.00614900\"},{\"symbol\":\"123456\",\"price\":\"0.00030000\"},{\"symbol\":\"QTUMETH\",\"price\":\"0.05899200\"},{\"symbol\":\"EOSETH\",\"price\":\"0.00938800\"},{\"symbol\":\"SNTETH\",\"price\":\"0.00046775\"},{\"symbol\":\"BNTETH\",\"price\":\"0.00746900\"},{\"symbol\":\"BCCBTC\",\"price\":\"0.15865000\"},{\"symbol\":\"GASBTC\",\"price\":\"0.00309200\"},{\"symbol\":\"BNBETH\",\"price\":\"0.01862000\"},{\"symbol\":\"BTCUSDT\",\"price\":\"16820.00000000\"},{\"symbol\":\"ETHUSDT\",\"price\":\"1074.00000000\"},{\"symbol\":\"HSRBTC\",\"price\":\"0.00138800\"},{\"symbol\":\"OAXETH\",\"price\":\"0.00261480\"},{\"symbol\":\"DNTETH\",\"price\":\"0.00033300\"},{\"symbol\":\"MCOETH\",\"price\":\"0.01559900\"},{\"symbol\":\"ICNETH\",\"price\":\"0.00414110\"},{\"symbol\":\"MCOBTC\",\"price\":\"0.00099800\"},{\"symbol\":\"WTCBTC\",\"price\":\"0.00084800\"},{\"symbol\":\"WTCETH\",\"price\":\"0.01330900\"},{\"symbol\":\"LRCBTC\",\"price\":\"0.00007269\"},{\"symbol\":\"LRCETH\",\"price\":\"0.00112075\"},{\"symbol\":\"QTUMBTC\",\"price\":\"0.00377000\"},{\"symbol\":\"YOYOBTC\",\"price\":\"0.00003198\"},{\"symbol\":\"OMGBTC\",\"price\":\"0.00119500\"},{\"symbol\":\"OMGETH\",\"price\":\"0.01873800\"},{\"symbol\":\"ZRXBTC\",\"price\":\"0.00009114\"},{\"symbol\":\"ZRXETH\",\"price\":\"0.00143737\"},{\"symbol\":\"STRATBTC\",\"price\":\"0.00101500\"},{\"symbol\":\"STRATETH\",\"price\":\"0.01581400\"},{\"symbol\":\"SNGLSBTC\",\"price\":\"0.00002244\"},{\"symbol\":\"SNGLSETH\",\"price\":\"0.00034650\"},{\"symbol\":\"BQXBTC\",\"price\":\"0.00064995\"},{\"symbol\":\"BQXETH\",\"price\":\"0.00999780\"},{\"symbol\":\"KNCBTC\",\"price\":\"0.00025727\"},{\"symbol\":\"KNCETH\",\"price\":\"0.00402000\"},{\"symbol\":\"FUNBTC\",\"price\":\"0.00001093\"},{\"symbol\":\"FUNETH\",\"price\":\"0.00017145\"},{\"symbol\":\"SNMBTC\",\"price\":\"0.00003901\"},{\"symbol\":\"SNMETH\",\"price\":\"0.00060639\"},{\"symbol\":\"NEOETH\",\"price\":\"0.09634100\"},{\"symbol\":\"IOTABTC\",\"price\":\"0.00023812\"},{\"symbol\":\"IOTAETH\",\"price\":\"0.00374946\"},{\"symbol\":\"LINKBTC\",\"price\":\"0.00006319\"},{\"symbol\":\"LINKETH\",\"price\":\"0.00099000\"},{\"symbol\":\"XVGBTC\",\"price\":\"0.00001095\"},{\"symbol\":\"XVGETH\",\"price\":\"0.00017161\"},{\"symbol\":\"CTRBTC\",\"price\":\"0.00019932\"},{\"symbol\":\"CTRETH\",\"price\":\"0.00313880\"},{\"symbol\":\"SALTBTC\",\"price\":\"0.00073400\"},{\"symbol\":\"SALTETH\",\"price\":\"0.01157300\"},{\"symbol\":\"MDABTC\",\"price\":\"0.00023549\"},{\"symbol\":\"MDAETH\",\"price\":\"0.00369050\"},{\"symbol\":\"MTLBTC\",\"price\":\"0.00042300\"},{\"symbol\":\"MTLETH\",\"price\":\"0.00669000\"},{\"symbol\":\"SUBBTC\",\"price\":\"0.00015400\"},{\"symbol\":\"SUBETH\",\"price\":\"0.00243996\"},{\"symbol\":\"EOSBTC\",\"price\":\"0.00059876\"},{\"symbol\":\"SNTBTC\",\"price\":\"0.00002998\"},{\"symbol\":\"ETCETH\",\"price\":\"0.03212600\"},{\"symbol\":\"ETCBTC\",\"price\":\"0.00203800\"},{\"symbol\":\"MTHBTC\",\"price\":\"0.00002910\"},{\"symbol\":\"MTHETH\",\"price\":\"0.00045763\"},{\"symbol\":\"ENGBTC\",\"price\":\"0.00037895\"},{\"symbol\":\"ENGETH\",\"price\":\"0.00591510\"},{\"symbol\":\"DNTBTC\",\"price\":\"0.00002144\"},{\"symbol\":\"ZECBTC\",\"price\":\"0.04063900\"},{\"symbol\":\"ZECETH\",\"price\":\"0.64001000\"},{\"symbol\":\"BNTBTC\",\"price\":\"0.00047248\"},{\"symbol\":\"ASTBTC\",\"price\":\"0.00008209\"},{\"symbol\":\"ASTETH\",\"price\":\"0.00127540\"},{\"symbol\":\"DASHBTC\",\"price\":\"0.07268000\"},{\"symbol\":\"DASHETH\",\"price\":\"1.13674000\"},{\"symbol\":\"OAXBTC\",\"price\":\"0.00016603\"},{\"symbol\":\"ICNBTC\",\"price\":\"0.00026674\"},{\"symbol\":\"BTGBTC\",\"price\":\"0.01558800\"},{\"symbol\":\"BTGETH\",\"price\":\"0.24358000\"},{\"symbol\":\"EVXBTC\",\"price\":\"0.00032440\"},{\"symbol\":\"EVXETH\",\"price\":\"0.00506230\"},{\"symbol\":\"REQBTC\",\"price\":\"0.00006025\"},{\"symbol\":\"REQETH\",\"price\":\"0.00094276\"},{\"symbol\":\"VIBBTC\",\"price\":\"0.00003979\"},{\"symbol\":\"VIBETH\",\"price\":\"0.00062260\"},{\"symbol\":\"HSRETH\",\"price\":\"0.02175400\"},{\"symbol\":\"TRXBTC\",\"price\":\"0.00000962\"},{\"symbol\":\"TRXETH\",\"price\":\"0.00015071\"},{\"symbol\":\"POWRBTC\",\"price\":\"0.00010469\"},{\"symbol\":\"POWRETH\",\"price\":\"0.00164000\"},{\"symbol\":\"ARKBTC\",\"price\":\"0.00045830\"},{\"symbol\":\"ARKETH\",\"price\":\"0.00720000\"},{\"symbol\":\"YOYOETH\",\"price\":\"0.00050131\"},{\"symbol\":\"XRPBTC\",\"price\":\"0.00015948\"},{\"symbol\":\"XRPETH\",\"price\":\"0.00250079\"},{\"symbol\":\"MODBTC\",\"price\":\"0.00048650\"},{\"symbol\":\"MODETH\",\"price\":\"0.00768900\"},{\"symbol\":\"ENJBTC\",\"price\":\"0.00002870\"},{\"symbol\":\"ENJETH\",\"price\":\"0.00045000\"},{\"symbol\":\"STORJBTC\",\"price\":\"0.00013288\"},{\"symbol\":\"STORJETH\",\"price\":\"0.00207020\"},{\"symbol\":\"BNBUSDT\",\"price\":\"20.10000000\"},{\"symbol\":\"VENBNB\",\"price\":\"0.22860000\"},{\"symbol\":\"YOYOBNB\",\"price\":\"0.02797000\"},{\"symbol\":\"POWRBNB\",\"price\":\"0.08786000\"},{\"symbol\":\"VENBTC\",\"price\":\"0.00027783\"},{\"symbol\":\"VENETH\",\"price\":\"0.00435991\"},{\"symbol\":\"KMDBTC\",\"price\":\"0.00058370\"},{\"symbol\":\"KMDETH\",\"price\":\"0.00920000\"},{\"symbol\":\"NULSBNB\",\"price\":\"0.30159000\"},{\"symbol\":\"RCNBTC\",\"price\":\"0.00002678\"},{\"symbol\":\"RCNETH\",\"price\":\"0.00042160\"},{\"symbol\":\"RCNBNB\",\"price\":\"0.02333000\"},{\"symbol\":\"NULSBTC\",\"price\":\"0.00036772\"},{\"symbol\":\"NULSETH\",\"price\":\"0.00560009\"},{\"symbol\":\"RDNBTC\",\"price\":\"0.00037795\"},{\"symbol\":\"RDNETH\",\"price\":\"0.00595000\"},{\"symbol\":\"RDNBNB\",\"price\":\"0.32313000\"},{\"symbol\":\"XMRBTC\",\"price\":\"0.02412500\"},{\"symbol\":\"XMRETH\",\"price\":\"0.38123000\"},{\"symbol\":\"DLTBNB\",\"price\":\"0.06047000\"},{\"symbol\":\"WTCBNB\",\"price\":\"0.69050000\"},{\"symbol\":\"DLTBTC\",\"price\":\"0.00007239\"},{\"symbol\":\"DLTETH\",\"price\":\"0.00114948\"},{\"symbol\":\"AMBBTC\",\"price\":\"0.00008065\"},{\"symbol\":\"AMBETH\",\"price\":\"0.00126696\"},{\"symbol\":\"AMBBNB\",\"price\":\"0.06583000\"},{\"symbol\":\"BCCETH\",\"price\":\"2.47327000\"},{\"symbol\":\"BCCUSDT\",\"price\":\"2672.62000000\"},{\"symbol\":\"BCCBNB\",\"price\":\"133.11000000\"},{\"symbol\":\"BATBTC\",\"price\":\"0.00004462\"},{\"symbol\":\"BATETH\",\"price\":\"0.00069746\"},{\"symbol\":\"BATBNB\",\"price\":\"0.03758000\"},{\"symbol\":\"BCPTBTC\",\"price\":\"0.00010726\"},{\"symbol\":\"BCPTETH\",\"price\":\"0.00168405\"},{\"symbol\":\"BCPTBNB\",\"price\":\"0.08696000\"},{\"symbol\":\"ARNBTC\",\"price\":\"0.00031672\"},{\"symbol\":\"ARNETH\",\"price\":\"0.00493035\"},{\"symbol\":\"GVTBTC\",\"price\":\"0.00218610\"},{\"symbol\":\"GVTETH\",\"price\":\"0.03416300\"},{\"symbol\":\"CDTBTC\",\"price\":\"0.00001465\"},{\"symbol\":\"CDTETH\",\"price\":\"0.00022677\"},{\"symbol\":\"GXSBTC\",\"price\":\"0.00053460\"},{\"symbol\":\"GXSETH\",\"price\":\"0.00838400\"},{\"symbol\":\"NEOUSDT\",\"price\":\"103.66200000\"},{\"symbol\":\"NEOBNB\",\"price\":\"5.17500000\"},{\"symbol\":\"POEBTC\",\"price\":\"0.00001198\"},{\"symbol\":\"POEETH\",\"price\":\"0.00018753\"},{\"symbol\":\"QSPBTC\",\"price\":\"0.00004097\"},{\"symbol\":\"QSPETH\",\"price\":\"0.00063047\"},{\"symbol\":\"QSPBNB\",\"price\":\"0.03472000\"},{\"symbol\":\"BTSBTC\",\"price\":\"0.00004834\"},{\"symbol\":\"BTSETH\",\"price\":\"0.00076020\"},{\"symbol\":\"BTSBNB\",\"price\":\"0.04039000\"},{\"symbol\":\"XZCBTC\",\"price\":\"0.00676200\"},{\"symbol\":\"XZCETH\",\"price\":\"0.10696800\"},{\"symbol\":\"XZCBNB\",\"price\":\"5.80600000\"},{\"symbol\":\"LSKBTC\",\"price\":\"0.00208600\"},{\"symbol\":\"LSKETH\",\"price\":\"0.03226500\"},{\"symbol\":\"LSKBNB\",\"price\":\"1.73930000\"},{\"symbol\":\"TNTBTC\",\"price\":\"0.00002183\"},{\"symbol\":\"TNTETH\",\"price\":\"0.00034716\"},{\"symbol\":\"FUELBTC\",\"price\":\"0.00002112\"},{\"symbol\":\"FUELETH\",\"price\":\"0.00033267\"},{\"symbol\":\"MANABTC\",\"price\":\"0.00001163\"},{\"symbol\":\"MANAETH\",\"price\":\"0.00018220\"},{\"symbol\":\"BCDBTC\",\"price\":\"0.00263400\"},{\"symbol\":\"BCDETH\",\"price\":\"0.04155000\"},{\"symbol\":\"DGDBTC\",\"price\":\"0.01124300\"},{\"symbol\":\"DGDETH\",\"price\":\"0.17700000\"},{\"symbol\":\"IOTABNB\",\"price\":\"0.19942000\"},{\"symbol\":\"ADXBTC\",\"price\":\"0.00020001\"},{\"symbol\":\"ADXETH\",\"price\":\"0.00313910\"},{\"symbol\":\"ADXBNB\",\"price\":\"0.17166000\"},{\"symbol\":\"ADABTC\",\"price\":\"0.00005896\"},{\"symbol\":\"ADAETH\",\"price\":\"0.00092160\"},{\"symbol\":\"PPTBTC\",\"price\":\"0.00270890\"},{\"symbol\":\"PPTETH\",\"price\":\"0.04246000\"},{\"symbol\":\"CMTBTC\",\"price\":\"0.00003000\"},{\"symbol\":\"CMTETH\",\"price\":\"0.00046700\"},{\"symbol\":\"CMTBNB\",\"price\":\"0.02439000\"},{\"symbol\":\"XLMBTC\",\"price\":\"0.00003602\"},{\"symbol\":\"XLMETH\",\"price\":\"0.00057201\"},{\"symbol\":\"XLMBNB\",\"price\":\"0.03101000\"},{\"symbol\":\"CNDBTC\",\"price\":\"0.00001039\"},{\"symbol\":\"CNDETH\",\"price\":\"0.00016250\"},{\"symbol\":\"CNDBNB\",\"price\":\"0.00862000\"},{\"symbol\":\"LENDBTC\",\"price\":\"0.00002220\"},{\"symbol\":\"LENDETH\",\"price\":\"0.00034868\"},{\"symbol\":\"WABIBTC\",\"price\":\"0.00021090\"},{\"symbol\":\"WABIETH\",\"price\":\"0.00334967\"},{\"symbol\":\"WABIBNB\",\"price\":\"0.17300000\"},{\"symbol\":\"LTCETH\",\"price\":\"0.26318000\"},{\"symbol\":\"LTCUSDT\",\"price\":\"282.99000000\"},{\"symbol\":\"LTCBNB\",\"price\":\"14.08000000\"},{\"symbol\":\"TNBBTC\",\"price\":\"0.00001322\"},{\"symbol\":\"TNBETH\",\"price\":\"0.00020707\"},{\"symbol\":\"WAVESBTC\",\"price\":\"0.00076680\"},{\"symbol\":\"WAVESETH\",\"price\":\"0.01202400\"},{\"symbol\":\"WAVESBNB\",\"price\":\"0.63000000\"},{\"symbol\":\"GTOBTC\",\"price\":\"0.00004050\"},{\"symbol\":\"GTOETH\",\"price\":\"0.00063600\"},{\"symbol\":\"GTOBNB\",\"price\":\"0.03328000\"},{\"symbol\":\"ICXBTC\",\"price\":\"0.00047450\"},{\"symbol\":\"ICXETH\",\"price\":\"0.00743000\"},{\"symbol\":\"ICXBNB\",\"price\":\"0.39882000\"},{\"symbol\":\"OSTBTC\",\"price\":\"0.00004860\"},{\"symbol\":\"OSTETH\",\"price\":\"0.00077777\"},{\"symbol\":\"OSTBNB\",\"price\":\"0.03891000\"},{\"symbol\":\"ELFBTC\",\"price\":\"0.00012013\"},{\"symbol\":\"ELFETH\",\"price\":\"0.00189945\"},{\"symbol\":\"AIONBTC\",\"price\":\"0.00054120\"},{\"symbol\":\"AIONETH\",\"price\":\"0.00845500\"},{\"symbol\":\"AIONBNB\",\"price\":\"0.47710000\"},{\"symbol\":\"NEBLBTC\",\"price\":\"0.00121750\"},{\"symbol\":\"NEBLETH\",\"price\":\"0.01888800\"},{\"symbol\":\"NEBLBNB\",\"price\":\"1.02790000\"},{\"symbol\":\"BRDBTC\",\"price\":\"0.00019040\"},{\"symbol\":\"BRDETH\",\"price\":\"0.00298640\"},{\"symbol\":\"BRDBNB\",\"price\":\"0.15891000\"},{\"symbol\":\"MCOBNB\",\"price\":\"0.84159000\"},{\"symbol\":\"EDOBTC\",\"price\":\"0.00036060\"},{\"symbol\":\"EDOETH\",\"price\":\"0.00553200\"},{\"symbol\":\"WINGSBTC\",\"price\":\"0.00012129\"},{\"symbol\":\"WINGSETH\",\"price\":\"0.00190360\"},{\"symbol\":\"NAVBTC\",\"price\":\"0.00023950\"},{\"symbol\":\"NAVETH\",\"price\":\"0.00374000\"},{\"symbol\":\"NAVBNB\",\"price\":\"0.18860000\"},{\"symbol\":\"LUNBTC\",\"price\":\"0.00300000\"},{\"symbol\":\"LUNETH\",\"price\":\"0.04703300\"},{\"symbol\":\"TRIGBTC\",\"price\":\"0.00049870\"},{\"symbol\":\"TRIGETH\",\"price\":\"0.00793000\"},{\"symbol\":\"TRIGBNB\",\"price\":\"0.43099000\"},{\"symbol\":\"APPCBTC\",\"price\":\"0.00019800\"},{\"symbol\":\"APPCETH\",\"price\":\"0.00309990\"},{\"symbol\":\"APPCBNB\",\"price\":\"0.16967000\"}]";

        given(binanceApi.balances()).willReturn(jsonParser.parse(balancesJson).getAsJsonArray());
        given(binanceApi.allPrices()).willReturn(jsonParser.parse(allPricesJson).getAsJsonArray());

        targets.setBinanceApi(binanceApi);
    }

    @Test
    public void 현재보유한_코인만_보여준다() throws Exception, BinanceApiException {
        List<Balance> balances = targets.getBalances();
        assertThat(balances.size(), is(5));
    }

    @Test
    public void 보유한_코인에_현재가격이_들어간다() {
        List<Balance> balances = targets.getBalances();
        Optional<Balance> btc = balances.stream()
                .filter(b -> b.getAsset().equals("CTR"))
                .findFirst();

        assertThat(btc.get().getCurrentUnitPrice(), is("0.00019932"));
    }

}